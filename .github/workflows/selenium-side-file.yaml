# Name of the GitHub Action Workflow
name: Run Selenium Chrome SIDE File Tests

# This workflow is triggered on every push to the repository
on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

    # Use the selenium/standalone-chrome Docker container
    container:
      image: selenium/standalone-chrome:latest
      options: --shm-size="2g"  # Increase shared memory size

    steps:
    # Checks out a copy of your repository on the ubuntu-latest machine
    - name: Checkout code
      uses: actions/checkout@v4

    # Installs selenium-side-runner
    - name: Install selenium-side-runner
      run: |
        npm install -g selenium-side-runner

    # Runs the Selenium IDE tests from the provided .side file
    - name: Run Selenium IDE tests
      run: selenium-side-runner -c "browserName=chrome chromeOptions.args=[--headless,--no-sandbox] webdriver.chrome.driver=/usr/bin/chromedriver" poc-azure-pipelines-selenium-tests.side

    # Fetch Docker logs if there's a failure
    - name: Fetch Docker logs
      if: failure()
      run: docker logs $(docker ps -q --filter ancestor=selenium/standalone-chrome:latest)
